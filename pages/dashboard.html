<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Axiom</title>
    <link rel="stylesheet" href="styles/global.css" />
    <link rel="stylesheet" href="styles/dashboard.css" />
    <link rel="stylesheet" href="alerts/notification.css" />
    <style>
      .nav-link {
        display: inline-flex;
        align-items: center;
        gap: 8px;
      }
      .nav-link img.icon-inline {
        height: 18px;
        width: 18px;
        display: inline-block;
      }
    </style>
  </head>
  <body>
    <div class="angled-header">
      <header class="top-header">
        <div class="header-inner column">
          <div class="header-center">
            <a href="index.html" class="nav-link" id="nav-home">
              <img
                src="../src/assets/home.png"
                alt="Home"
                class="icon-inline"
              />
              <span>Home</span>
            </a>
            <span class="user-info">Welcome to Axiom Dashboard</span>
          </div>

          <div class="header-toolbar">
            <div class="toolbar-surface">
              <button
                id="start-bot"
                class="pill-btn sm btn-start"
                aria-label="Start bot"
              >
                <span class="btn-emoji">🚀</span
                ><span class="btn-text">Start Bot</span>
              </button>
              <span class="toolbar-sep" aria-hidden="true"></span>
              <button
                id="stop-bot"
                class="pill-btn sm btn-stop"
                aria-label="Stop bot"
              >
                <span class="btn-emoji">🛑</span
                ><span class="btn-text">Stop Bot</span>
              </button>
            </div>
          </div>
        </div>
      </header>
    </div>

    <section class="owner-only" id="owner-panel">
      <div class="card-slider-wrapper">
        <button class="scroll-btn scroll-left" onclick="shiftCard(-1)">
          ‹
        </button>
        <button class="scroll-btn scroll-right" onclick="shiftCard(1)">
          ›
        </button>

        <div class="card-slider" id="card-slider">
          <div class="card ghost-card"></div>

          <div class="card gradient1" id="channel-registry-card">
            <img
              src="../src/assets/channels.png"
              alt="Channels Icon"
              class="icon-img-large"
            />
            <div class="card-label">Channel Registry</div>
          </div>

          <div class="card gradient2" id="giveaway-gate-card">
            <img
              src="../src/assets/giveaway.png"
              alt="Giveaway Icon"
              class="icon-img-large"
            />
            <div class="card-label">Giveaway</div>
          </div>

          <div class="card gradient3" id="tickets-card">
            <img
              src="../src/assets/tickets.png"
              alt="Tickets Logs Icon"
              class="icon-img-large"
            />
            <div class="card-label">Tickets</div>
          </div>

          <div class="card gradient4" id="embed-card">
            <img
              src="../src/assets/embed.png"
              alt="Embed Icon"
              class="icon-img-large"
            />
            <div class="card-label">Embed Builder</div>
          </div>

          <div class="card gradient5" id="config-editor-card">
            <img
              src="../src/assets/config.png"
              alt="Config Icon"
              class="icon-img-large"
            />
            <div class="card-label">Config Editor</div>
          </div>

          <div class="card gradient6">System Info 4</div>
          <div class="card gradient7">System Info 5</div>
          <div class="card gradient8">System Info 6</div>
          <div class="card gradient9">System Info 7</div>
          <div class="card gradient10">System Info 8</div>

          <div class="card ghost-card"></div>
        </div>
      </div>
    </section>

    <div id="alert-container" class="alert-container"></div>

    <script src="alerts/notification.js"></script>
    <script>
      function safeNotify(type, title, message) {
        if (typeof showNotification === "function") {
          showNotification(type, title, message);
        } else {
          console.log("[" + type + "] " + title + ": " + message);
        }
      }

      function setButtonState(button, emoji, text, disabled = false) {
        const emojiSpan = button.querySelector(".btn-emoji");
        const textSpan = button.querySelector(".btn-text");
        if (emojiSpan) emojiSpan.textContent = emoji;
        if (textSpan) textSpan.textContent = text;
        button.disabled = disabled;
      }

      document.addEventListener("DOMContentLoaded", function () {
        const hasApi = typeof window.api !== "undefined" && window.api !== null;

        const startBtn = document.getElementById("start-bot");
        const stopBtn = document.getElementById("stop-bot");

        const onStarted =
          typeof window.api?.onBotStarted === "function"
            ? window.api.onBotStarted
            : null;
        const onStopped =
          typeof window.api?.onBotStopped === "function"
            ? window.api.onBotStopped
            : null;

        startBtn.addEventListener("click", function () {
          setButtonState(startBtn, "⏳", "Starting…", true);
          stopBtn.disabled = true;
          safeNotify("help", "Starting…", "The bot is starting up.");

          if (!hasApi || typeof window.api.startBot !== "function") {
            safeNotify(
              "fail",
              "Unavailable",
              "API bridge not available in this build."
            );
            setButtonState(startBtn, "🚀", "Start Bot", false);
            stopBtn.disabled = false;
            return;
          }

          try {
            window.api.startBot();
          } catch (e) {
            console.error(e);
            safeNotify("fail", "Start failed", "Could not start the bot.");
            setButtonState(startBtn, "🚀", "Start Bot", false);
            stopBtn.disabled = false;
            return;
          }

          const done = () => {
            setButtonState(startBtn, "🚀", "Start Bot", false);
            stopBtn.disabled = false;
            safeNotify("success", "Started", "The bot is now running.");
          };

          if (onStarted) onStarted(done);
          else setTimeout(done, 1200);
        });

        stopBtn.addEventListener("click", function () {
          setButtonState(stopBtn, "⏳", "Stopping…", true);
          startBtn.disabled = true;
          safeNotify("warning", "Stopping…", "The bot is stopping.");

          if (!hasApi || typeof window.api.stopBot !== "function") {
            safeNotify(
              "fail",
              "Unavailable",
              "API bridge not available in this build."
            );
            setButtonState(stopBtn, "🛑", "Stop Bot", false);
            startBtn.disabled = false;
            return;
          }

          try {
            window.api.stopBot();
          } catch (e) {
            console.error(e);
            safeNotify("fail", "Stop failed", "Could not stop the bot.");
            setButtonState(stopBtn, "🛑", "Stop Bot", false);
            startBtn.disabled = false;
            return;
          }

          const done = () => {
            setButtonState(stopBtn, "🛑", "Stop Bot", false);
            startBtn.disabled = false;
            safeNotify("success", "Stopped", "The bot has been stopped.");
          };

          if (onStopped) onStopped(done);
          else setTimeout(done, 1200);
        });

        document
          .getElementById("channel-registry-card")
          .addEventListener("click", function () {
            window.api?.openWindow?.("channels.html");
          });
        document
          .getElementById("giveaway-gate-card")
          .addEventListener("click", function () {
            window.location.href = "giveaway.html";
          });
        document
          .getElementById("tickets-card")
          .addEventListener("click", function () {
            window.location.href = "tickets.html";
          });
        document
          .getElementById("embed-card")
          .addEventListener("click", function () {
            window.location.href = "embedbuilder.html";
          });
        document
          .getElementById("config-editor-card")
          .addEventListener("click", function () {
            window.location.href = "configeditor.html";
          });

        const cardSlider = document.getElementById("card-slider");
        cardSlider.addEventListener("scroll", updateCardTransforms);
        window.addEventListener("resize", updateCardTransforms);
        updateCardTransforms();

        const firstActualCard = cardSlider.querySelector(
          ".card:not(.ghost-card):first-of-type"
        );
        if (firstActualCard) {
          firstActualCard.classList.add("active");
          const sliderCenter = cardSlider.offsetWidth / 2;
          const cardCenter =
            firstActualCard.offsetLeft + firstActualCard.offsetWidth / 2;
          const scrollTo = cardCenter - sliderCenter;
          cardSlider.scrollTo({ left: scrollTo, behavior: "auto" });
        }
      });

      function updateCardTransforms() {
        const slider = document.getElementById("card-slider");
        const cards = slider.querySelectorAll(".card");
        const sliderRect = slider.getBoundingClientRect();
        const centerX = sliderRect.left + sliderRect.width / 2;

        let closestCard = null;
        let closestDistance = Infinity;

        cards.forEach(function (card) {
          if (card.classList.contains("ghost-card")) {
            card.style.transform = "none";
            card.style.opacity = "0";
            card.style.zIndex = "unset";
            card.classList.remove("active");
            return;
          }

          const cardRect = card.getBoundingClientRect();
          const cardCenter = cardRect.left + cardRect.width / 2;
          const offset = (centerX - cardCenter) / sliderRect.width;

          const distance = Math.abs(centerX - cardCenter);
          if (distance < closestDistance) {
            closestDistance = distance;
            closestCard = card;
          }

          if (card !== closestCard) {
            const rotateY = offset * 30;
            const scale = 1 - Math.min(Math.abs(offset) * 0.4, 0.4);
            card.style.transform =
              "rotateY(" + rotateY + "deg) scale(" + scale + ")";
            card.style.opacity = String(1 - Math.abs(offset) * 0.6);
            card.style.zIndex = String(
              100 - Math.round(Math.abs(offset) * 100)
            );
          } else {
            card.style.transform = "rotateY(0deg) scale(1)";
            card.style.opacity = "1";
            card.style.zIndex = "200";
          }
        });

        cards.forEach(function (card) {
          card.classList.remove("active");
        });
        if (closestCard && !closestCard.classList.contains("ghost-card")) {
          closestCard.classList.add("active");
        }
      }

      function shiftCard(direction) {
        const slider = document.getElementById("card-slider");
        const allCards = Array.from(slider.querySelectorAll(".card"));
        const actualCards = allCards.filter(
          (c) => !c.classList.contains("ghost-card")
        );
        const activeCard = slider.querySelector(".card.active");

        let currentIndex = actualCards.indexOf(activeCard);
        if (currentIndex === -1) currentIndex = 0;

        const newIndex = Math.max(
          0,
          Math.min(currentIndex + direction, actualCards.length - 1)
        );
        const targetCard = actualCards[newIndex];
        const cardCenter = targetCard.offsetLeft + targetCard.offsetWidth / 2;
        const scrollTo = cardCenter - slider.offsetWidth / 2;

        slider.scrollTo({ left: scrollTo, behavior: "smooth" });
      }
    </script>
  </body>
</html>
